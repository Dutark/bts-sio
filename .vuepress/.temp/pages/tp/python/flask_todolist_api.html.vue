<template><h1 id="ecrire-des-api-avec-flask" tabindex="-1"><a class="header-anchor" href="#ecrire-des-api-avec-flask" aria-hidden="true">#</a> √âcrire des API avec Flask</h1>
<h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2>
<p>Dans ce TP nous allons cr√©er des API √† l‚Äôaide de Flask pour notre site web TodoList. Nous allons bien √©videmment utiliser l‚Äôinterface que vous avez d√©velopp√©e dans le TP 1 VueJS. Ici nous allons recoder la partie ¬´ serveur ¬ª en python gr√¢ce au micro framework Flask.</p>
<p>Pour ne pas compliquer le TP je vais faire abstraction de la base de donn√©es, nous allons utiliser la session comme la premi√®re version de l‚Äôapplication.</p>
<h2 id="le-main-py" tabindex="-1"><a class="header-anchor" href="#le-main-py" aria-hidden="true">#</a> Le main.py</h2>
<p>Comme dans le premier TP notre code sera int√©gralement dans un fichier nomm√© ¬´ main.py ¬ª. Le fichier va contenir les diff√©rentes fonctions pour r√©pondre aux diff√©rentes requ√™tes des clients.</p>
<p>Comme dans le premier TP, avant de commencer √† coder nous allons d√©terminer le nom des fonctions ainsi que le chemin et les m√©thodes (POST, GET, DELETE, ‚Ä¶):</p>
<table>
<thead>
<tr>
<th>Description</th>
<th>Chemin</th>
<th>M√©thode</th>
<th>Fonction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Liste</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Cr√©ation</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Marquer comme termin√©</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Supprimer</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Question :</p>
<ul>
<li>C‚Äôest √† vous, avant de continuer un papier un crayon ! Remplissez le tableau.</li>
</ul>
<Reveal text="Voir l‚Äôune des solutions possibles">
<table>
<thead>
<tr>
<th>Description</th>
<th>Chemin</th>
<th>M√©thode</th>
<th>Fonction</th>
</tr>
</thead>
<tbody>
<tr>
<td>Liste</td>
<td>/api/todo</td>
<td>GET</td>
<td>liste()</td>
</tr>
<tr>
<td>Cr√©ation</td>
<td>/api/todo</td>
<td>POST</td>
<td>creer()</td>
</tr>
<tr>
<td>Marquer comme termin√©</td>
<td>/api/todo/done/&lt;current_id&gt;</td>
<td>POST</td>
<td>terminer()</td>
</tr>
<tr>
<td>Supprimer</td>
<td>/api/todo/delete/&lt;current_id&gt;</td>
<td>DELETE</td>
<td>suppression()</td>
</tr>
</tbody>
</table>
<p>Question :</p>
<ul>
<li>√Ä votre avis pourquoi est-ce important de faire ce travail ?</li>
<li>Quelles sont les autres solutions pour r√©pondre √† ce genre de soucis ?</li>
</ul>
</Reveal>
<h3 id="structure-de-base" tabindex="-1"><a class="header-anchor" href="#structure-de-base" aria-hidden="true">#</a> Structure de base</h3>
<p>Cr√©er un fichier <code>main.py</code> c‚Äôest ce fichier qui va contenir l‚Äôensemble de votre code, comme dans la version PHP, nous allons utiliser le JSON pour communiquer.</p>
<p>Le minimum pour notre TP fonctionne est la d√©claration des imports suivants :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> uuid
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> jsonify<span class="token punctuation">,</span> request<span class="token punctuation">,</span> session
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Pour l‚Äôinstant l‚Äôobjet Flask n‚Äôest pas initialis√© votre code n‚Äôest donc pas fonctionnel. Avant de continuer, regardons l‚Äôutilit√© des imports :</p>
<ul>
<li><a href="https://docs.python.org/3/library/uuid.html" target="_blank" rel="noopener noreferrer">uuid<ExternalLinkIcon/></a></li>
<li><a href="http://flask.pocoo.org/" target="_blank" rel="noopener noreferrer">Flask<ExternalLinkIcon/></a></li>
<li><a href="http://flask.pocoo.org/docs/0.12/api/#flask.json.jsonify" target="_blank" rel="noopener noreferrer">jsonify<ExternalLinkIcon/></a></li>
<li><a href="http://flask.pocoo.org/docs/0.12/api/#flask.request" target="_blank" rel="noopener noreferrer">request<ExternalLinkIcon/></a></li>
<li><a href="http://flask.pocoo.org/docs/0.12/api/#sessions" target="_blank" rel="noopener noreferrer">session<ExternalLinkIcon/></a></li>
</ul>
<h3 id="la-partie-flask" tabindex="-1"><a class="header-anchor" href="#la-partie-flask" aria-hidden="true">#</a> La partie Flask</h3>
<p>Maintenant que vous avez compris l‚Äôusage des diff√©rents imports, nous allons initialiser Flask. Ajouter <strong>√† la fin</strong> du fichier :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code>app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'YOLO_EXAMPLE_CHANGEME'</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Vous pouvez maintenant lancer votre application, via :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>python main.pys
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul>
<li>√Ä quoi sert <code>app.secret_key</code> ?</li>
<li>Comment changer le port d‚Äô√©coute ? (La r√©ponse est l√†‚Ä¶ <a href="http://flask.pocoo.org/" target="_blank" rel="noopener noreferrer">sur la documentation officielle<ExternalLinkIcon/></a>‚Ä¶ quelques part‚Ä¶)</li>
</ul>
<h3 id="liste" tabindex="-1"><a class="header-anchor" href="#liste" aria-hidden="true">#</a> Liste</h3>
<p>Comme dans le premier TP, l‚ÄôAPI <code>list</code> ne va faire que retourner la liste des t√¢ches actuellement dans la session.</p>
<p>Avec Flask √ßa va √™tre <strong>tr√®s</strong> simple ! Il suffit de faire :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Tr√®s bien, mais on fait √ßa o√π ? Dans une fonction, il faut donc cr√©er une fonction dans le fichier <code>main.py</code> pour le nom de la fonction je vous laisse vous reporter <a href="#le-mainpy">√† votre tableau</a>, pour le premier je vous aide :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/todo"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">liste</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Retourne la liste des todo dans la session """</span>
    <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>üïµÔ∏è‚Äç‚ôÄÔ∏è Notez le commentaire dans la fonction‚Ä¶ J‚Äôesp√®re que vous allez en mettre vous aussi‚Ä¶</p>
<p>Question :</p>
<ul>
<li>Comment √™tre sure que la session est bien initialis√©e ?</li>
</ul>
<h3 id="votre-decorateur" tabindex="-1"><a class="header-anchor" href="#votre-decorateur" aria-hidden="true">#</a> Votre d√©corateur</h3>
<p>Et voil√†, c‚Äôest le moment‚Ä¶ Le moment ou vous allez √©crire votre propre d√©corateur ! (Si certains ont oubli√© ce que c‚Äô√©tait un d√©corateur <RouterLink to="/tp/python/flask.html#associer-un-lien-et-une-fonction">rendez-vous ici</RouterLink>)</p>
<p>Tr√®s bien, maintenant que vous avez la m√©moire fraiche, voil√† votre d√©corateur :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps
<span class="token keyword">from</span> flask <span class="token keyword">import</span> session
<span class="token keyword">def</span> <span class="token function">init_session</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" D√©corateur qui init la session """</span>
    <span class="token decorator annotation punctuation">@wraps</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token string">"todo"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
            session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> fn<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrap
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>O√π mettre le code ?</p>
<ul>
<li>Choix 1 : Directement dans le main.py</li>
<li>Choix 2 : Dans un autre fichier (exemple helper.py)</li>
</ul>
<p>Vous avez le choix‚Ä¶ Si vous faites le choix de mettre le fichier dans un autre fichier, il faudra importer <code>init_session</code> dans le main.py :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> helper <span class="token keyword">import</span> init_session
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>PS Je vous conseille de le mettre dans un fichier <code>helper.py</code>.</p>
<h3 id="modification-de-la-liste" tabindex="-1"><a class="header-anchor" href="#modification-de-la-liste" aria-hidden="true">#</a> Modification de la liste</h3>
<p>Maintenant que votre d√©corateur est termin√©, nous allons l‚Äôutiliser. Avant la fonction <code>liste()</code> ajouter <code>@init_session()</code> exemple :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/todo"</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@init_session</span> <span class="token comment"># &lt;-- Voil√† ICI, ajouter l‚Äôappel au d√©corateur.</span>
<span class="token keyword">def</span> <span class="token function">liste</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">[</span>‚Ä¶<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>üéì Le d√©corateur va √™tre appel√© avant chaque requ√™te, votre session sera toujours bien cr√©√©e, pratique non ?</p>
<h3 id="creation" tabindex="-1"><a class="header-anchor" href="#creation" aria-hidden="true">#</a> Cr√©ation</h3>
<p>Comme dans le premier TP la partie cr√©ation doit comporter un test :</p>
<ul>
<li>Est-ce que <code>e</code> est dans data ?</li>
</ul>
<p>Ce test s‚Äô√©crit en Python :</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token punctuation">[</span>‚Ä¶<span class="token punctuation">]</span>
<span class="token keyword">if</span> <span class="token string">"texte"</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token punctuation">[</span>‚Ä¶<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul>
<li>L‚Äôautre √©l√©ment important, c‚Äôest l‚Äôunicit√© d‚Äôune t√¢che dans la session, en python √ßa se fait avec :</li>
</ul>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> uuid
<span class="token punctuation">[</span>‚Ä¶<span class="token punctuation">]</span>
uniq_id <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Comme pour la liste, vous pouvez vous reporter √† votre tableau contenant ¬´ le mapping ¬ª entre le chemin et la m√©thode, voil√† ce que √ßa donne dans mon cas :</p>
<Reveal text="Cliquer pour afficher une solution possible">
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/todo"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@init_session</span>
<span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Save a new element in the session["todo"] """</span>
    data <span class="token operator">=</span> request<span class="token punctuation">.</span>form
    <span class="token keyword">if</span> <span class="token string">"texte"</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"texte"</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">"texte"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"termine"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span>
        session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></Reveal>
<p>Questions :</p>
<ul>
<li>R√©aliser la methode dans votre code par rapport au tableau de d√©finition que vous avez √©crit.</li>
<li>√Ä quoi sert request.form ? (Voir la doc de Flask)</li>
<li>Pourquoi ai-je fait ¬´ session.modified = True ¬ª ? √Ä votre avis ? (La r√©ponse est dans la documentation de Flask)</li>
</ul>
<h3 id="marquer-comme-termine" tabindex="-1"><a class="header-anchor" href="#marquer-comme-termine" aria-hidden="true">#</a> Marquer comme termin√©</h3>
<p>Marquer comme termin√© une tache c‚Äôest changer le statut de ¬´ termine ¬ª √† <code>true</code>.</p>
<ul>
<li>Utiliser le d√©corateur d‚Äôinitialisation de la session.</li>
<li>V√©rifier que la t√¢che existe dans la session. (En python <code>if current_id in session[&quot;todo&quot;]:</code>)</li>
<li>R√©cup√©rer la t√¢che dans la session.</li>
<li>Changer <code>current['termine'] = True</code>.</li>
<li>Sauvegarder √† nouveau la tache dans la session.</li>
</ul>
<p>Questions :</p>
<ul>
<li>√âcrire l‚Äôalgorithme (en Fran√ßais), du code √† obtenir.</li>
<li>Le retranscrire en Python.</li>
<li>L‚Äôimpl√©menter dans votre fichier main.py (en respectant le tableau √©tabli)</li>
</ul>
<Reveal text="Cliquer pour afficher une solution possible">
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/todo/done/&lt;current_id>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@init_session</span>
<span class="token keyword">def</span> <span class="token function">terminer</span><span class="token punctuation">(</span>current_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Marquer une Todo comme termine """</span>
    <span class="token comment"># L'id est termine, et present dans la session</span>
    <span class="token keyword">if</span> current_id <span class="token keyword">in</span> session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        current <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>current_id<span class="token punctuation">]</span>
        current<span class="token punctuation">[</span><span class="token string">"termine"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token comment"># Mark As done</span>
        session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>current_id<span class="token punctuation">]</span> <span class="token operator">=</span> current <span class="token comment"># and Save</span>
        session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></Reveal>
<h3 id="suppression" tabindex="-1"><a class="header-anchor" href="#suppression" aria-hidden="true">#</a> Suppression</h3>
<p>Supprimer une t√¢che, c‚Äôest tout simplement l‚Äôaction de la retirer de la session, pour faire √ßa le mot-cl√© et python c‚Äôest <code>del</code>. Cependant votre code doit bloquer certaines actions, car toutes les t√¢ches ne peuvent pas √™tre supprim√©es :</p>
<ul>
<li>Limiter l‚Äôaction seulement aux ¬´ identifiants ¬ª reconnus dans la session.</li>
<li>La t√¢che doit avoir le bool√©en ¬´ termine ¬ª √† vrai pour permettre la suppression.</li>
</ul>
<p>Votre algorithme doit donc suivre :</p>
<ul>
<li>Utiliser le d√©corateur qui initialise la session.</li>
<li>V√©rifier que la t√¢che existe dans la session. (En Python <code>if current_id in session[&quot;todo&quot;]:</code>)</li>
<li>V√©rifier que la t√¢che √† bien le statut <code>termine == True</code>. (en Python <code>session[&quot;todo&quot;][current_id][&quot;termine&quot;]</code>)</li>
<li>Suppression de la t√¢che (<code>del ‚Ä¶</code>).</li>
<li>Sauvegarder √† nouveau la tache dans la session.</li>
</ul>
<p>Questions :</p>
<ul>
<li>√âcrire l‚Äôalgorithme (en Fran√ßais) du code √† obtenir.</li>
<li>Le retranscrire en Python</li>
<li>L‚Äôimpl√©menter dans votre fichier main.py (en respectant le tableau √©tabli)</li>
</ul>
<Reveal text="Cliquer pour afficher une solution possible">
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/api/todo/delete/&lt;current_id>"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@init_session</span>
<span class="token keyword">def</span> <span class="token function">suppression</span><span class="token punctuation">(</span>current_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Suppression d'un element de la session["todo"] """</span>
    <span class="token comment"># current_id exist and mark as done ?</span>
    <span class="token keyword">if</span> current_id <span class="token keyword">in</span> session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span> <span class="token keyword">and</span> session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>current_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"termine"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">del</span> session<span class="token punctuation">[</span><span class="token string">"todo"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>current_id<span class="token punctuation">]</span> <span class="token comment"># Remove the data</span>
        session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"success"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></Reveal>
<h2 id="tests" tabindex="-1"><a class="header-anchor" href="#tests" aria-hidden="true">#</a> Tests</h2>
<p>Maintenant que l‚Äôensemble de votre code est termin√© (et comment√© üïµüèª), nous allons pouvoir le tester, pour tester les API c‚Äôest plut√¥t simple. Il suffit d‚Äôutiliser des outils tels que <a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">Postman<ExternalLinkIcon/></a>, l‚Äôid√©e c‚Äôest de se construire un ¬´ cahier ¬ª de test vous permettant de valider le fonctionnement de votre application rapidement (comprendre d√®s que vous modifiez le code). C‚Äôest dans ce but que je vous ai pr√©par√© une collection de ¬´ tests ¬ª qui devrait vous permettre de valider rapidement le bon fonctionnement de vos API.</p>
<p><a href="https://raw.githubusercontent.com/c4software/api-todo-flask/master/test/TODO%20API%20Test.postman_collection.json" target="_blank" rel="noopener noreferrer">T√©l√©charger la collection de tests<ExternalLinkIcon/></a></p>
<p>Question :</p>
<ul>
<li>Valider le bon fonctionnement de votre application gr√¢ce au jeu de test.</li>
</ul>
<h2 id="utilisation-des-api" tabindex="-1"><a class="header-anchor" href="#utilisation-des-api" aria-hidden="true">#</a> Utilisation des API</h2>
<p>Mettre √† jour le code de votre TP ¬´ Ajouter VueJS dans un site existant ¬ª pour utiliser ces nouvelles API.</p>
</template>
