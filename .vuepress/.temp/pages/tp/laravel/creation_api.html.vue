<template><h1 id="todolist-re-ecrire-les-api-du-projet" tabindex="-1"><a class="header-anchor" href="#todolist-re-ecrire-les-api-du-projet" aria-hidden="true">#</a> TodoList : (RÃ©-)Ã©crire les API du projet</h1>
<p>Le but de notre application est de crÃ©er des API Rest qui vont exposer la gestion de nos <code>todos</code> dÃ©finie en base de donnÃ©es</p>
<h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2>
<p>Dans ce TP nous allons voir la crÃ©ation dâ€™API pour le projet Â« TodoList Â». Nous allons donc crÃ©er un nouveau projet avec Laravel pour crÃ©er des API qui permettront de :</p>
<ul>
<li>Lister les Ã©lÃ©ments dans la TodoList.</li>
<li>CrÃ©er un nouvel Ã©lÃ©ment dans la TodoList.</li>
<li>Marquer un Ã©lÃ©ment comme terminÃ©.</li>
<li>Supprimer un Ã©lÃ©ment.</li>
</ul>
<h2 id="creation-du-projet" tabindex="-1"><a class="header-anchor" href="#creation-du-projet" aria-hidden="true">#</a> CrÃ©ation du projet</h2>
<p>Pour crÃ©er des API, Laravel est un peu Â« lourd Â» (dans notre cas bien Ã©videmment, dans certains cas le choix est complÃ¨tement justifiÃ©). Nous allons donc utiliser son petit frÃ¨re Lumen. Lumen est un microframework reprenant les concepts de Laravel (et les mÃªmes briques), mais en beaucoup plus petit et donc plus adaptÃ© Ã  des micro-projets comme celui-ci.</p>
<h2 id="installer-lumen" tabindex="-1"><a class="header-anchor" href="#installer-lumen" aria-hidden="true">#</a> Installer Lumen</h2>
<p>Lâ€™installation de Lumen est similaire Ã  celle de Laravel</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">composer</span> global require <span class="token string">"laravel/lumen-installer"</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="creer-le-nouveau-projet" tabindex="-1"><a class="header-anchor" href="#creer-le-nouveau-projet" aria-hidden="true">#</a> CrÃ©er le nouveau Projet</h2>
<p>Maintenant que vous avez installÃ© Lumen nous allons pouvoir utiliser la ligne de commande pour crÃ©er un nouveau projet :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>lumen new api-todo
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>âœ‹ Attention, le projet va Ãªtre crÃ©Ã© dans le dossier <code>api-todo</code> dans le dossier courant.</p>
<h2 id="initialisation" tabindex="-1"><a class="header-anchor" href="#initialisation" aria-hidden="true">#</a> Initialisation</h2>
<p>Contrairement Ã  un projet Laravel, les dÃ©pendances <code>composer</code> ne sont pas installÃ©es par dÃ©faut. Il faut donc les installer via la ligne de commande en faisant :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">composer</span> <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Le projet nâ€™Ã©tant pas initialisÃ© nous allons devoir jouer quelques commandes pour terminer lâ€™installation :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">mv</span> .env.example .env
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>PS Sous Windows c'est :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>move .env.example .env
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Contrairement Ã  Laravel, Lumen ne contient pas lâ€™outil permettant dâ€™initialiser la Â« secret key Â» nÃ©cessaire Ã  la sÃ©curisation de votre application. Je vous propose par exemple de passer via la commande suivante :</p>
<p>PS Sous Windows la commande ne fonctionnera pas.</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>openssl rand -base64 <span class="token number">24</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>(Vous pouvez Ã©galement faire du monkey typingâ€¦ et saisir une chaine de caractÃ¨re alÃ©atoire avec votre clavierâ€¦)</p>
<p>Ã©diter le fichier <code>.env</code> pour y renseigner la valeur obtenue :</p>
<ul>
<li><code>APP_KEY</code> (exemple <code>APP_KEY=&quot;I82xtis8Tsur2&quot;</code>)</li>
</ul>
<h2 id="tester-votre-application" tabindex="-1"><a class="header-anchor" href="#tester-votre-application" aria-hidden="true">#</a> Tester votre application</h2>
<p>Pour tester votre application avec Lumen sur votre poste, câ€™est un peu plus Â« complexe Â» quâ€™avec Laravel. Vous devez saisir la commande suivante :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>php -S localhost:8000 -t ./public
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Une fois lancÃ© vous avez un serveur Web qui Ã©coute sur <a href="http://localhost:8000" target="_blank" rel="noopener noreferrer">le port 8000<ExternalLinkIcon/></a></p>
<p>ğŸ¤” Pourquoi Lumen nâ€™intÃ¨gre pas la commande <code>php artisan serve</code> ? La raison est plutÃ´t logique, Lumen Ã©tant un <code>micro framework</code> il nâ€™embarque pas toutes les options de base de Laravel. Options qui peuvent dâ€™ailleurs simplement Ãªtre remplacÃ©es.</p>
<h2 id="gestion-de-la-base-de-donnees" tabindex="-1"><a class="header-anchor" href="#gestion-de-la-base-de-donnees" aria-hidden="true">#</a> Gestion de la base de donnÃ©es</h2>
<p>Pour la dÃ©monstration nous allons utiliser SQLite au lieu de MySQL. Pour Ã§a rien de plus simple, Lumen utilise PDO il suffit donc de changer la configuration par dÃ©faut dans le fichier <code>.env</code>. Modifier le fichier pour quâ€™il ressemble Ã  celui-ci.</p>
<div class="language-apacheconf ext-apacheconf line-numbers-mode"><pre v-pre class="language-apacheconf"><code>APP_ENV=local
APP_DEBUG=true
APP_KEY=<span class="token string">"CHANGEME"</span>
APP_TIMEZONE=UTC

DB_CONNECTION=sqlite
<span class="token comment"># DB_HOST=127.0.0.1</span>
<span class="token comment"># DB_PORT=3306</span>
<span class="token comment"># DB_DATABASE=homestead</span>
<span class="token comment"># DB_USERNAME=homestead</span>
<span class="token comment"># DB_PASSWORD=secret</span>

CACHE_DRIVER=file
QUEUE_DRIVER=sync
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Par dÃ©faut, la configuration de base de SQLite dans Lumen est lâ€™utilisation dâ€™une base de donnÃ©es nommÃ©e <code>database.sqlite</code> il faut donc crÃ©er un fichier vide qui recevra les donnÃ©es :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">touch</span> database/database.sqlite
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Sous Windows la commande <code>touch</code> n'existe pas. Il faut crÃ©er un fichier <code>vide (sans retour Ã  la ligne)</code> dans votre IDE / Ã©diteur de texte.</p>
<p>Câ€™est parti ! Tout est prÃªt, nous pouvons commencer Ã  Ã©crire du code.</p>
<h3 id="le-script-de-creation-migration" tabindex="-1"><a class="header-anchor" href="#le-script-de-creation-migration" aria-hidden="true">#</a> Le script de crÃ©ation / migration</h3>
<p>Contrairement Ã  la premiÃ¨re version de notre application, nous allons stocker les donnÃ©es dans une base de donnÃ©es. Qui dit base de donnÃ©es dit Â« ORM Â» et donc mapping objet. Pour rappel un ORM :</p>
<blockquote>
<p>Un mapping objet-relationnel (en anglais object-relational mapping ou ORM) est une technique de programmation informatique qui crÃ©e l'illusion d'une base de donnÃ©es orientÃ©e objet Ã  partir d'une base de donnÃ©es relationnelle en dÃ©finissant des correspondances entre cette base de donnÃ©es et les objets du langage utilisÃ©.</p>
</blockquote>
<p>Pour rappel, le but de notre application est de crÃ©er des API Rest qui vont exposer la gestion de nos <code>todos</code> dÃ©finie en base de donnÃ©es. La premiÃ¨re Ã©tape est de crÃ©er via la ligne de commande le Â« script Â» qui initialisera la structure de votre base de donnÃ©es.</p>
<p>Lâ€™option <code>--create=todos</code> permet dâ€™indiquer le nom de la table Ã  crÃ©er</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>php artisan make:migration create_todos_table --create<span class="token operator">=</span>todos
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>âœ‹ Le contenu du fichier est fictif, il est lÃ  pour illustrer comment travailler. Nous allons le modifier pour mettre les informations relatives Ã  notre table.</p>
<p>La commande a crÃ©Ã© un nouveau fichier (dans mon cas) : <code>database/migration/2017_11_02_205700_create_todos_table.php</code></p>
<p>Dans le fichier crÃ©Ã© nous allons dÃ©finir notre schÃ©ma (Ã  savoir la dÃ©finition de la table) pour ajouter les 2 colonnes qui nous seront utiles <code>texte</code> et <code>termine</code>. Le fichier aprÃ¨s modification doit ressembler Ã  :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Schema</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Schema<span class="token punctuation">\</span>Blueprint</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Migrations<span class="token punctuation">\</span>Migration</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateTodosTable</span> <span class="token keyword">extends</span> <span class="token class-name">Migration</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Run the migrations.
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">void</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'todos'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Blueprint</span> <span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$table</span><span class="token operator">-></span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$table</span><span class="token operator">-></span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'texte'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$table</span><span class="token operator">-></span><span class="token function">boolean</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'termine'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$table</span><span class="token operator">-></span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Reverse the migrations.
     *
     * <span class="token keyword">@return</span> <span class="token class-name"><span class="token keyword">void</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">dropIfExists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'todos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>Maintenant que le script est terminÃ©, nous pouvons lancer la commande de migration :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>php artisan migrate
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Une fois cette commande lancÃ©e, Lumen va crÃ©er la structure de base de votre base de donnÃ©es.</p>
<h3 id="le-modele" tabindex="-1"><a class="header-anchor" href="#le-modele" aria-hidden="true">#</a> Le modÃ¨le</h3>
<p>Maintenant que nous avons fait le script de crÃ©ation / migration, nous allons dÃ©finir notre modÃ¨le. Pour Ã§a crÃ©ez un fichier <code>Todos.php</code> dans le dossier <code>app/</code> avec le contenu suivant :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Database<span class="token punctuation">\</span>Eloquent<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Todos</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$fillable</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'texte'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'termine'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>le <code>$fillable</code> dÃ©finie les propriÃ©tÃ©s qui doivent Ãªtres automatiquement remplis par Eloquent (lâ€™ORM) lors de lâ€™exÃ©cution du code.</p>
<h2 id="le-controller" tabindex="-1"><a class="header-anchor" href="#le-controller" aria-hidden="true">#</a> Le controller</h2>
<p>Maintenant que nous avons notre base de donnÃ©es, nous allons crÃ©er le contrÃ´leur. Pour rappel le controller va faire Â« le lien Â» entre la base de donnÃ©es et les appels HTTP. Câ€™est ici que nous allons mettre la logique mÃ©tier de nos API.</p>
<p>Pour commencer, nous allons crÃ©er Â« la structure de base Â» de notre contrÃ´leur. Pour Ã§a crÃ©ez le fichier <code>TodosController.php</code> dans le chemin suivant <code>app/Http/Controllers/</code> et mettez y le contenu suivant :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Todos</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>


<span class="token keyword">class</span> <span class="token class-name-definition class-name">TodosController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">{</span>
    <span class="token comment">// Câ€™est ici que seront nos mÃ©thodes</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Bien ! Notre code est maintenant prÃªt. Nous allons crÃ©er les mÃ©thodes permettant la manipulation de notre base de donnÃ©es tout en rÃ©pondant Ã  nos API bien Ã©videmment (liste, crÃ©ation, terminer, suppression).</p>
<p>Nous allons maintenant Ã©crire une mÃ©thode pour chaque action. Avec les diffÃ©rentes conditions nÃ©cessaires au bon fonctionnement de votre application.</p>
<h3 id="liste" tabindex="-1"><a class="header-anchor" href="#liste" aria-hidden="true">#</a> Liste</h3>
<p>La mÃ©thode <code>liste</code> est certainement la plus simple, nous allons simplement faire appel Ã  la mÃ©thode <code>all()</code> de Eloquent (ORM pour lâ€™accÃ¨s Ã  la base de donnÃ©es). Pour Ã§a crÃ©ez une nouvelle mÃ©thode dans la Class <code>TodoController</code> avec le code suivant :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$todos</span>  <span class="token operator">=</span> <span class="token class-name static-context">Todos</span><span class="token operator">::</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$todos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Rien de bien compliquÃ©, comme vous pouvez le voir le <code>response()-&gt;json(â€¦)</code> permet de crÃ©er une rÃ©ponse au format JSON pour votre API (que lâ€™on utilisera plus tard au moment de la mise en place des routes).</p>
<h3 id="creation" tabindex="-1"><a class="header-anchor" href="#creation" aria-hidden="true">#</a> CrÃ©ation</h3>
<p>Pour la partie crÃ©ation, nous allons faire un mapping automatique entre la requÃªte HTTP et le modÃ¨le <code>Todos</code></p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">saveTodo</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$todo</span> <span class="token operator">=</span> <span class="token class-name static-context">Todos</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-></span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token variable">$todo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Que va-t-il se passer lors de lâ€™appel ? Lâ€™objet <code>$request</code> contiens tous les paramÃ¨tres de lâ€™appel HTTP, la mÃ©thode <code>all()</code> permets de les rÃ©cupÃ©rer. Lâ€™objet <code>Todos</code> possÃ¨de une mÃ©thode permettant de crÃ©er un nouvel enregistrement en base de donnÃ©es. Les valeurs passÃ©es en paramÃ¨tre de <code>create()</code> permettre de renseigner automatiquement les champs en base de donnÃ©es.</p>
<h3 id="creation-version-alternative" tabindex="-1"><a class="header-anchor" href="#creation-version-alternative" aria-hidden="true">#</a> CrÃ©ation, version alternative</h3>
<p>La premiÃ¨re approche est la plus rapide, mais elle sous-entend que tous les paramÃ¨tres soient bien initialisÃ©s dans Â« lâ€™input Â» HTTP. Dans cette version la mÃ©thode est plus complÃ¨te et gÃ¨re la crÃ©ation de lâ€™objet Todo manuellement en rÃ©cupÃ©rant les diffÃ©rents Ã©lÃ©ments dans la requÃªte HTTP</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">saveTodo</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$texte</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-></span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'texte'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$texte</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$todo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Todos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$todo</span><span class="token operator">-></span><span class="token property">texte</span> <span class="token operator">=</span> <span class="token variable">$texte</span><span class="token punctuation">;</span>
      <span class="token variable">$todo</span><span class="token operator">-></span><span class="token property">termine</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token variable">$todo</span><span class="token operator">-></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="terminer" tabindex="-1"><a class="header-anchor" href="#terminer" aria-hidden="true">#</a> Terminer</h3>
<p>Pour lâ€™action terminer nous allons devoir updater un enregistrement en base de donnÃ©es, pour Ã§a nous allons le rÃ©cupÃ©rer puis mettre le <code>boolean</code> termine Ã  1.</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">markAsDone</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$todo</span>  <span class="token operator">=</span> <span class="token class-name static-context">Todos</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$todo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$todo</span><span class="token operator">-></span><span class="token property">termine</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token variable">$todo</span><span class="token operator">-></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="suppression" tabindex="-1"><a class="header-anchor" href="#suppression" aria-hidden="true">#</a> Suppression</h3>
<p>Pour la partie suppression, nous allons devoir dans un premier temps rÃ©cupÃ©rer la todo par son ID. Seuls les <code>Todos</code> marquÃ©s comme terminÃ©s peuvent Ãªtre supprimÃ©s, il faudra donc controller lâ€™Ã©tat avant de faire le <code>delete()</code></p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">deleteTodo</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$todo</span>  <span class="token operator">=</span> <span class="token class-name static-context">Todos</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$todo</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$todo</span><span class="token operator">-></span><span class="token property">termine</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$todo</span><span class="token operator">-></span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">json</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="declarer-les-routes" tabindex="-1"><a class="header-anchor" href="#declarer-les-routes" aria-hidden="true">#</a> DÃ©clarer les routes</h2>
<p>Maintenant que le mapping avec la base de donnÃ©es est crÃ©Ã©, et que notre contrÃ´leur est disponible, nous allons pouvoir dÃ©clarer les diffÃ©rentes Â« routes Â» (câ€™est-Ã -dire les chemins dâ€™accÃ¨s Ã  votre API). Dans notre application nous avons 4 routes :</p>
<ul>
<li>Liste (/liste)</li>
<li>CrÃ©ation (/creation)</li>
<li>Terminer (/terminer)</li>
<li>Suppression (/suppression)</li>
</ul>
<p>Nous allons Â« mapper Â» / Â« connecter Â» les routes avec les diffÃ©rentes actions de notre contrÃ´leur. Avec un framework câ€™est trÃ¨s simple il suffit dâ€™ajouter dans le fichier <code>routes/web.php</code> le code suivant :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token variable">$router</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'api/todo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'TodosController@list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$router</span><span class="token operator">-></span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'api/todo'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'TodosController@saveTodo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$router</span><span class="token operator">-></span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'api/todo/done/{id}'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'TodosController@markAsDone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$router</span><span class="token operator">-></span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'api/todo/delete/{id}'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'TodosController@deleteTodo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="activer-le-support-d-eloquent" tabindex="-1"><a class="header-anchor" href="#activer-le-support-d-eloquent" aria-hidden="true">#</a> Activer le support dâ€™Eloquent</h2>
<p>Avant de pouvoir tester votre application vous devez Ã©diter le fichier <code>bootstrap/app.php</code> pour dÃ©commenter la ligne :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token variable">$app</span><span class="token operator">-></span><span class="token function">withEloquent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Eloquent ? <a href="https://laravel.com/docs/5.6/eloquent" target="_blank" rel="noopener noreferrer">Un peu de documentation sur le Framework d'accÃ¨s Ã  la base de donnÃ©es<ExternalLinkIcon/></a> (ouiâ€¦ On ne fera pas de requÃªte !)</p>
<h2 id="tester" tabindex="-1"><a class="header-anchor" href="#tester" aria-hidden="true">#</a> Tester</h2>
<p>Pour tester votre application, il suffit de lancer la commande suivante :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>php -S localhost:8000 -t ./public
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Pour tester, vous pouvez utiliser PostMan.</p>
<h2 id="changer-les-api-dans-votre-application-vuejs" tabindex="-1"><a class="header-anchor" href="#changer-les-api-dans-votre-application-vuejs" aria-hidden="true">#</a> Changer les API dans votre application VueJS</h2>
<p>Maintenant que vos nouvelles API sont terminÃ©es, nous allons pouvoir les utiliser dans VueJS. Pour Ã§a Ã©diter le code JavaScript de votre projet VueJS pour pointer vers votre serveur Lumen.</p>
</template>
